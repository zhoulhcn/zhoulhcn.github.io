import{d as Z,r as X,I as at,s as J,e as Q,f as N,p as lt,n as ct,_ as nt,C as Wt,P as jt,O as Kt,g as tt}from"./index-BQXm6FxJ.js";import{g as gt,e as vt,z as Ft,W as xt,i as Dt,T as _t,v as wt,d as et,a as L,A as Xt,S as Lt,M as rt,n as q,E as $t,l as Y,H as At,s as qt,B as bt,b as it,t as Yt,I as Ut,J as zt,N as Zt,Q as W,V as _,U as Pt,C as G,o as Vt,m as Jt,X as Qt,c as Ht,P as te,Y as ee,Z as j,_ as re,O as ie,$ as Bt,a0 as ht,a1 as oe,a2 as ae,f as ne,a3 as se,a4 as le,a5 as ce,j as Et,y as ue}from"./OrbitControls-BFpgcgwR.js";const he=e=>(lt("data-v-29b24291"),e=e(),ct(),e),pe={class:"chapter-item"},de=he(()=>N("h2",null,"Session 3",-1)),fe=.1,pt=400,dt=400,me=180,ye=Z({__name:"chapter-03",setup(e){let t=50,r=10;const i=Math.PI*2;let o=0,a=0;const n=X(null),l=X(null),c=X(null);let u,m;at(()=>{d(),f(),h(),y()});function d(){var v,x;n.value&&(n.value.width=pt,n.value.height=dt),l.value&&(l.value.width=pt,l.value.height=dt),u=(v=n.value)==null?void 0:v.getContext("2d"),m=(x=l.value)==null?void 0:x.getContext("2d")}function f(){u.beginPath();const v=200*Math.sin(Math.PI/3)+100;u.moveTo(200,100),u.lineTo(100,v),u.lineTo(300,v);const x=u.createLinearGradient(200,100,200,v);x.addColorStop(0,"#3DD1F2"),x.addColorStop(1,"#EF2233"),u.fillStyle=x,u.fill()}function h(){const x=i/1e3,w=200;u.beginPath();for(let O=0;O<1e3;O++){u.strokeStyle=`rgb(${Math.random()*256}, ${Math.random()*256}, ${Math.random()*256})`,u.lineWidth=4;const B=Math.sin(x*O*(t/50))*Math.cos(x*O*(r/50))*w,k=Math.sin(x*O*(t/50))*Math.sin(x*O*(r/50))*w;u.lineTo(B+w,k+w)}u.stroke(),u.closePath()}function p(v){t=v.clientX,r=v.clientY,u.clearRect(0,0,pt,dt),f(),h()}function y(){var x;a=(a+fe)%(Math.PI*64);const v=(x=c==null?void 0:c.value)==null?void 0:x.value;o=Math.min(v,1)*me,m.clearRect(0,0,pt,dt),g(-2,"rgba(0,155,155,0.1)"),g(-6,"rgba(25,255,55,0.2)"),g(6,"rgba(22,213,155,0.4)"),g(2,"rgba(35,255,155,0.6)"),g(1,"rgba(144,121,44,1)",1.5),requestAnimationFrame(y)}function g(v,x,w=1){m.moveTo(0,0),m.beginPath(),m.strokeStyle=x,m.lineWidth=w||1;let O,B;const k=2,M=4;for(let F=-k;F<=k;F+=.01){const E=Math.pow(k*4/(k*4+Math.pow(F,4)),k*2);O=pt*(F+k)/(k*2),B=dt/2+o*E*(1/v)*Math.sin(M*F-a),m.lineTo(O,B)}m.stroke()}return(v,x)=>(J(),Q("div",pe,[de,N("canvas",{ref_key:"canvas1Ref",ref:n,onMousemove:p},null,544),N("input",{type:"range",value:"0.2",ref_key:"rangeRef",ref:c,min:"0",max:"1",step:"0.01"},null,512),N("canvas",{ref_key:"canvas2Ref",ref:l},null,512)]))}}),ge=nt(ye,[["__scopeId","data-v-29b24291"]]),ve="/lab-static/images/graph-london/render-test.jpg",Nt=e=>(lt("data-v-94074a61"),e=e(),ct(),e),xe={class:"chapter-item"},_e=Nt(()=>N("h2",null,"Session 4",-1)),we=Nt(()=>N("div",{class:"box"},[N("h4",null,"Before"),N("img",{src:ve,alt:""})],-1)),Ae=Nt(()=>N("h4",null,"After 通过滚轮来改变效果程度",-1)),be=Z({__name:"chapter-04",setup(e){const t=X(null);at(()=>{c()});let r=256;function i(d){d.preventDefault(),d.deltaY>0?r=Math.min(256,r+50):r=Math.max(1,r-50),u()}let o=null,a=null,n=0,l=0;function c(){const d=new Image;d.src="/lab-static/images/graph-london/render-test.jpg",d.onload=()=>{var f;o=(f=t.value)==null?void 0:f.getContext("2d",{willReadFrequently:!0}),n=d.width,l=d.height,o&&(o.drawImage(d,0,0),a=o.getImageData(0,0,n,l).data,u())}}function u(){const d=[.0925,.225,.0925,.225,.15,.225,.0925,.225,.0925],f=[0,0,0,0,1,0,0,0,0],h=o.getImageData(0,0,n,l);for(let p=0;p<l;p++)for(let y=0;y<n;y++){const g=(n*p+y)*4+0,v=(n*p+y)*4+1,x=(n*p+y)*4+2,w=(n*p+y)*4+3;a[g]%255<r?(h.data[g]=m(d,p,y,0),h.data[v]=m(d,p,y,1),h.data[x]=m(d,p,y,2),h.data[w]=255):(h.data[g]=m(f,p,y,0),h.data[v]=m(f,p,y,1),h.data[x]=m(f,p,y,2),h.data[w]=255)}o.putImageData(h,0,0)}function m(d,f,h,p){return d[0]*a[(n*f-1+h-1)*4+p]+d[1]*a[(n*f-1+h)*4+p]+d[2]*a[(n*f-1+h+1)*4+p]+d[3]*a[(n*f+h-1)*4+p]+d[4]*a[(n*f+h)*4+p]+d[5]*a[(n*f+h+1)*4+p]+d[6]*a[(n*f+1+h-1)*4+p]+d[7]*a[(n*f+1+h)*4+p]+d[8]*a[(n*f+1+h+1)*4+p]}return(d,f)=>(J(),Q("div",xe,[_e,we,N("div",{class:"box",onWheel:i},[Ae,N("canvas",{ref_key:"renderCanvas",ref:t,width:"400",height:"284"},null,512)],32)]))}}),Ce=nt(be,[["__scopeId","data-v-94074a61"]]),Rt=400,It=400,ft=100,Tt=360/10;class Ee{constructor(t,r,i,o){this.x=t,this.y=r,this.z=i,this.r=o,this.canvasW=2*o}paint(t,r,i,o){t.save(),t.beginPath();const a=(this.z*r+ft)/(2*ft);t.arc(i+this.x*r,o+this.y*r,this.r*r,0,2*Math.PI,!0),t.fillStyle="rgba(0,255,255,"+(a+.5)+")",t.fill(),t.restore()}}class kt{constructor(t,r){const i=Math.sqrt(Math.pow(ft,2)-Math.pow(ft*Math.cos(t*Math.PI*2/Tt),2));this.radius=i,this.x=0,this.y=0,this.up=r;const o=[];for(let a=0;a<Tt;a++){const n=2*Math.PI/Tt*a,l=new Ee(i*Math.cos(n),i*Math.sin(n),this.up*Math.sqrt(Math.pow(ft,2)-Math.pow(i,2)),1.5);o.push(l)}this.balls=o}}class Te{constructor(){this.orbitRadius=mt(Me(Rt,It)),this.radius=mt(200,this.orbitRadius)/8,this.orbitX=Rt/2,this.orbitY=It/2,this.timePassed=mt(0,1e3),this.speed=mt(this.orbitRadius)/5e4}draw(t,r){const i=Math.sin(this.timePassed)*this.orbitRadius+this.orbitX,o=Math.cos(this.timePassed)*this.orbitRadius+this.orbitY;t.drawImage(r,i-this.radius/2,o-this.radius/2,this.radius,this.radius),this.timePassed+=this.speed}}function Me(e,t){const i=Math.max(e,t);return Math.round(Math.sqrt(i*i+i*i))/2}function mt(e,t){if(arguments.length<2&&(t=e,e=0),e>t){const r=t;t=e,e=r}return Math.floor(Math.random()*(t-e+1))+e}class Se{constructor(t){this.listSize=t,this.starList=[]}initialStars(t){for(let r=0;r<t;r++){const i=new Te;this.starList.push(i)}}stars(){return this.starList.length===0&&this.initialStars(this.listSize),this.starList}}class Oe{constructor(t){this.listSize=t,this.ballList=[]}initialBalls(t){const r=t;for(let i=0;i<=r;i++){const o=new kt(i,1);this.ballList.push(...o.balls);const a=new kt(i,-1);this.ballList.push(...a.balls)}}balls(){return this.ballList.length===0&&this.initialBalls(this.listSize),this.ballList}}const Pe=e=>(lt("data-v-14460b4d"),e=e(),ct(),e),Re=Pe(()=>N("h2",null,"Session 5",-1)),Ie=Z({__name:"chapter-05",setup(e){at(()=>{a(),F()});const t=X(null);let r,i,o;function a(){t.value&&(t.value.setAttribute("width",Rt),t.value.setAttribute("height",It),r=t.value.getContext("2d"),i=t.value.width/2,o=t.value.height/2)}let n=0,l=0,c=5,u=1,m=1;function d(E){E.preventDefault(),E.deltaY>0?m=Math.min(c,m+.1):m=Math.max(u,m-.1)}function f(){n=0,l=0}function h(E){E.preventDefault();const P=(E.offsetX-i)/i,A=(E.offsetY-o)/o,D=Math.PI*P,$=Math.PI*A;l=-D*.01,n=-$*.01}function p(){const E=Math.cos(n),P=Math.sin(n);for(let A=0;A<M.length;A++){const D=M[A].y*E-M[A].z*P,$=M[A].z*E+M[A].y*P;M[A].y=D,M[A].z=$}}function y(){const E=Math.cos(l),P=Math.sin(l);for(let A=0;A<M.length;A++){const D=M[A].x*E-M[A].z*P,$=M[A].z*E+M[A].x*P;M[A].x=D,M[A].z=$}}function g(){const E=Math.cos(l),P=Math.sin(l);for(let A=0;A<M.length;A++){const D=M[A].x*E-M[A].y*P,$=M[A].y*E+M[A].x*P;M[A].x=D,M[A].y=$}}function v(){const E=document.createElement("canvas"),P=E.getContext("2d");E.width=20,E.height=20;const A=E.width/2,D=P.createRadialGradient(A,A,0,A,A,A);return D.addColorStop(.065,"#CCC"),D.addColorStop(.1,"hsl(230, 61%, 33%)"),D.addColorStop(.25,"hsl(230, 64%, 6%)"),D.addColorStop(1,"transparent"),P.fillStyle=D,P.beginPath(),P.arc(A,A,A,0,Math.PI*2),P.fill(),E}function x(){p(),y(),g()}const w=v(),B=new Se(500).stars(),M=new Oe(12).balls();function F(){if(!(!r||!t.value)){r.clearRect(0,0,t.value.width,t.value.height);for(let E=1,P=B.length;E<P;E++)B[E].draw(r,w);x();for(let E=0;E<M.length;E++)M[E].paint(r,m,i,o);requestAnimationFrame(F)}}return(E,P)=>(J(),Q("div",{class:"chapter-item",onWheel:d,onMousemove:h,onMouseout:f},[Re,N("canvas",{ref_key:"renderCanvas",ref:t},null,512)],32))}}),Le=nt(Ie,[["__scopeId","data-v-14460b4d"]]),ze=e=>(lt("data-v-3b58dad0"),e=e(),ct(),e),Ne={class:"chapter-item"},Be=ze(()=>N("h2",null,"Session 6",-1)),ke=Z({__name:"chapter-06",setup(e){const t=X(null);let r=null,i=null,o=null,a=null,n=null,l=null,c=null;function u(){r=new gt(70,400/300,1,1e3),i=new vt,a=new Ft("rgb(255,255,255)"),o=new xt,n=new Dt(r,o.domElement)}function m(){r.position.x=10,r.position.y=10,r.position.z=10,a.position.set(0,2,2),i.add(a);const h=new _t;o.shadowMap.enabled=!0;const p=new wt(10,20,1,1),y=new et({color:16777215}),g=new L(p,y);g.receiveShadow=!0,g.position.x=0,g.position.y=0,g.position.z=0,g.rotation.x=-.5*Math.PI,i.add(g);const v=new Xt(789516);i.add(v);const x=new Lt(1,20,20),w=h.load("/lab-static/images/graph-london/sky.jpg"),O=new rt({map:w});c=new L(x,O),c.position.x=4,c.position.y=0,c.position.z=2,c.castShadow=!0,i.add(c);const B=new q(1,1,1),k=h.load("/lab-static/images/webgl-practice/sy.jpg"),M=new rt({map:k});l=new L(B,M),l.castShadow=!0,l.position.x=-2,l.position.y=3,l.position.z=1,i.add(l);const F=new $t(16777215);F.position.set(0,6,2),F.castShadow=!0,i.add(F),o.setPixelRatio(window.devicePixelRatio),o.setSize(400,300),Wt(t).appendChild(o.domElement)}let d=0;function f(){l.rotation.x+=.02,l.rotation.y+=.02,l.rotation.z+=.02,d+=.04,c.position.x=1+Math.cos(d),c.position.y=2+Math.abs(Math.sin(d)),n.update(),o.render(i,r),requestAnimationFrame(f)}return at(()=>{u(),m(),requestAnimationFrame(f)}),(h,p)=>(J(),Q("div",Ne,[Be,N("div",{ref_key:"canvasRef",ref:t},null,512)]))}}),Fe=nt(ke,[["__scopeId","data-v-3b58dad0"]]),De=e=>(lt("data-v-aae36154"),e=e(),ct(),e),Ue=De(()=>N("h2",null,"Session 7",-1)),Ve=[Ue],Mt=400,St=400,He=1,Ge=Z({__name:"chapter-07",setup(e){at(()=>{n(),l()});let t,r,i,o;const a=X(null);function n(){var h;t=new gt(75,Mt/St,.1,1e3),t.position.z=1,r=new vt;const m=new wt(2,2);o={time:{type:"f",value:1},resolution:{type:"v2",value:new Y(Mt*window.devicePixelRatio,St*window.devicePixelRatio)},mouse:{type:"v2",value:new Y}};const d=new At({uniforms:o,vertexShader:"void main(){gl_Position=vec4(position,1.);}",fragmentShader:`
      // 精度定义
      precision mediump float;
      // 参数接收
      uniform vec2 resolution;
      uniform vec2 mouse;
      uniform float time;
      // taskA: 尝试通过使用时间统一和数学函数来修改片段着色器的颜色
      vec3 highlight(vec2 coord) {
        // 相当于x的取值范围是0-屏幕宽度
        float coordX = mod(time*100.0, resolution.x);
        // 计算屏幕中心
        float cx = resolution.x / 2.0;
        float cy = resolution.y / 2.0;
        float a = 2.0;
        // 计算高亮的区域
        if(coord.x > coordX && coord.x < coordX + 20.0) {
          a = 1.0;
        }
        vec3 c = vec3(1.0,1.0,1.0);
        // 根据所属屏幕区域设置颜色
        if(coord.x<cx && coord.y<cy) {
          c = vec3(0.4,0.8,0.066);
        }
        if(coord.x<cx && coord.y>cy) {
          c = vec3(0.79,0.199,0.199);
        }
        if(coord.x>cx && coord.y<cy) {
          c = vec3(0,0.59,0.39);
        }
        if(coord.x>cx && coord.y>cy) {
          c = vec3(0.79,0.79,0.59);
        }
        return c / a;
      }
      // 鼠标指向圆形的半径
      float radius = 30.0;
      void main(){
        // 这个片元应该呈现的颜色
        vec3 colour=highlight(gl_FragCoord.xy);
        // 计算鼠标指向的坐标，即圆心
        float x = mouse.x;
        float y = resolution.y - mouse.y;
        // 圆心向量
        vec2 pos=vec2(x,y);
        // 计算片元距离圆心的距离
        float d=distance(gl_FragCoord.xy,pos);
        if(d<=radius + 5.0) {
          // 将背景色作为圆形的颜色
          vec3 circleColor = highlight(pos.xy);
          gl_FragColor = vec4(circleColor / .5, 1);
        }else{
          gl_FragColor=vec4(colour, 1.0);
        }
      }
    `}),f=new L(m,d);r.add(f),i=new xt,i.setPixelRatio(window.devicePixelRatio/He),i.setSize(Mt,St),(h=a.value)==null||h.appendChild(i.domElement)}function l(){u(),requestAnimationFrame(l)}function c(m){o.mouse.value.x=m.offsetX*window.devicePixelRatio,o.mouse.value.y=m.offsetY*window.devicePixelRatio}function u(){o.time.value+=.01,i.render(r,t)}return(m,d)=>(J(),Q("div",{class:"chapter-item",ref_key:"session7Ref",ref:a,onMousemove:c},Ve,544))}}),We=nt(Ge,[["__scopeId","data-v-aae36154"]]),je=N("h2",null,"Session 8",-1),Ke=[je],Xe=`
  // 设置为高精度运算
  precision highp float;
  // 法向量
  varying vec3 myNormal;
  varying vec4 myPosition;
  // 位置坐标
  vec3 newPosition;
  // 鼠标位置信息
  uniform highp vec2 mouse;
  // 运行时间信息
  uniform highp float time;
  varying vec4 v_Position;
  varying vec4 v_Normal;
  // 定义π
  #define M_PI 3.14159265358979323846

  // 生成伪随机数，对应高度值
  float rand2d(vec2 pos){
    return sin(sin(dot(pos*123.,vec2(1000.0)))*1000000.0);
  }
  // 点元着色器主函数
  void main(){
    // taskA: 创建一个平移，使地平面在地面上——它目前在空中！
    // 将平面顺时针旋转1.2，大概69度。
    // 将这个值改成90度即可完成。
    // 角度弧度互转网站http://www.ab126.com/geometric/10631.html
    float angle=-1.57;
    // 绕X渲染的模型矩阵
    mat4 rotateX=mat4(1,0,0,0,0,cos(angle),sin(angle),0,0,-sin(angle),cos(angle),0,0,0,0,1);
    myNormal=normal;
    // 根据xy生成z的值，即高度
    float displaceZ=rand2d(position.xy);
    vec3 newPosition=position;
    // 改变z值
    newPosition.z=newPosition.z+(displaceZ*.01);
    // 乘以旋转矩阵
    vec4 rotatedPos=rotateX*vec4(newPosition,1.);
    // 获取旋转之后的法向量
    myNormal=normalize(rotatedPos.xyz*1.2);
    // 乘以视图矩阵和模型矩阵计算出新的位置坐标
    vec4 vertexPosition = projectionMatrix*modelViewMatrix*vec4(rotatedPos.xyz,.5);
    myPosition = vertexPosition;
    // 乘以视图矩阵和模型矩阵
    gl_Position= vertexPosition;
  }
`,$e=`
  precision highp float;
  // 记录鼠标位置和时间的uniform变量
  uniform vec2 mouse;
  uniform float time;
  varying vec3 myNormal;
  varying vec4 myPosition;
  uniform vec2 resolution;
  // 柏林噪声算法
  float r(vec2 n)
  {
      return fract(cos(dot(n,vec2(36.26,73.12)))*354.63);
  }
  // 噪声函数
  float noise(vec2 n)
  {
      vec2 fn = floor(n);
      vec2 sn = smoothstep(vec2(0),vec2(1),fract(n));
      float h1 = mix(r(fn),r(fn+vec2(1,0)),sn.x);
      float h2 = mix(r(fn+vec2(0,1)),r(fn+vec2(1)),sn.x);
      return mix(h1,h2,sn.y);
  }
  // Mandelbrot 着色器
  float Mandelbrot(vec2 n) {
    vec2 c=(n-resolution/2.)/resolution.x*4.*(-.25*mouse.x)+(1.-mouse.y);
    float colour=0.;
    vec2 z=vec2(0.);

    for(int i=0;i<200;i++){
      colour++;
      if(dot(z,z)>2.){break;}
      z=vec2(z.x*z.x-z.y*z.y,2.*z.x*z.y)+c;
    }
    return colour/100.0;
  }

  float perlin(vec2 n) {
      return noise(n/32.)*0.5875+noise(n/16.)/5.+noise(n/8.)/10.+noise(n/4.)/20.+noise(n/2.)/40.+noise(n)/80.;
  }
  // taskB-1: 修改地形生成器函数（随机函数），制作更有趣的地形
  // 在地形上叠加了Mandelbrot算法生成的颜色
  // 新增了一个点光源，红色
  void main(){
    // 此处可以切换看不同的效果
    // 柏林噪声效果
    // vec4 color = vec4(vec3(perlin(gl_FragCoord.xy)),1.0);
    // 单色效果
    // vec4 color = vec4(1.0,1.0,1.0,1.0);
    // Mandelbrot效果
    vec4 color = vec4(vec3(Mandelbrot(gl_FragCoord.xy)),1.0);
    // 环境光
    vec3 AmbientLight = vec3(0.2, 0.2, 0.2);
    vec3 light1 = AmbientLight * color.rgb;
    // taskB-2: 您可能需要移动灯光。您可能还需要更多灯。你能做这个吗？
    // 此处增加了一个青色的点光源
    // 点光源
    vec3 dotPosition = vec3(-0.1, 0.1, 0.5);
    vec3 dotColor = vec3(0.0, 0.6, 0.4);
    // 计算点光源和点的方向向量
    vec3 lightDirection = normalize(dotPosition - vec3(myPosition));
    float nDot2 = max(dot(myNormal,lightDirection ), 0.0);
    vec3 light2 = dotColor * color.rgb * nDot2;
    // 平行光源
    vec3 light=vec3(-0.1,-0.1,-0.1);
    light=normalize(light);
    // 计算光的分量
    float nDot=max(0.,dot(myNormal,light));
    vec3 light3 = color.rgb*nDot;
    // 平行光再加上0.25的环境光
    gl_FragColor=vec4(light1 + light2 + light3, color.a);
  }
`,qe=1,Ye=Z({__name:"chapter-08",setup(e){const t=X(null);let r,i,o,a;function n(){var g;r=new gt(70,400/400,.1,1e3),r.position.x=0,r.position.y=.4,r.position.z=.4,r.lookAt(0,0,0),i=new vt,l();const d=new wt(1,1,100,100),f=new Lt(.05,100,100);a={time:{type:"f",value:1},resolution:{type:"v2",value:new Y},mouse:{type:"v2",value:new Y}};const h=new At({uniforms:a,vertexShader:Xe,fragmentShader:$e}),p=new L(d,h),y=new L(f,h);i.add(p),i.add(y),o=new xt,o.setPixelRatio(window.devicePixelRatio/qe),o.setSize(400,400),(g=t.value)==null||g.appendChild(o.domElement)}function l(){const d=c({x:0,y:0,z:0},{x:100,y:0,z:0},16738740),f=c({x:0,y:0,z:0},{x:0,y:100,z:0},64154),h=c({x:0,y:0,z:0},{x:0,y:0,z:100},3329330);i.add(d),i.add(f),i.add(h)}function c(d,f,h){const p=new qt({color:h}),y=new bt,g=new Float32Array([d.x,d.y,d.z,f.x,f.y,f.z]);return y.setAttribute("position",new it(g,3)),new Yt(y,p)}function u(){requestAnimationFrame(u),m()}function m(){a.time.value+=.01,o.render(i,r)}return at(()=>{n(),u()}),(d,f)=>(J(),Q("div",{class:"chapter-item",ref_key:"session8Ref",ref:t},Ke,512))}});var Gt={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(jt,function(){var r=function(){function i(h){return n.appendChild(h.dom),h}function o(h){for(var p=0;p<n.children.length;p++)n.children[p].style.display=p===h?"block":"none";a=h}var a=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(h){h.preventDefault(),o(++a%n.children.length)},!1);var l=(performance||Date).now(),c=l,u=0,m=i(new r.Panel("FPS","#0ff","#002")),d=i(new r.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=i(new r.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:n,addPanel:i,showPanel:o,begin:function(){l=(performance||Date).now()},end:function(){u++;var h=(performance||Date).now();if(d.update(h-l,200),h>c+1e3&&(m.update(1e3*u/(h-c),100),c=h,u=0,f)){var p=performance.memory;f.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return h},update:function(){l=this.end()},domElement:n,setMode:o}};return r.Panel=function(i,o,a){var n=1/0,l=0,c=Math.round,u=c(window.devicePixelRatio||1),m=80*u,d=48*u,f=3*u,h=2*u,p=3*u,y=15*u,g=74*u,v=30*u,x=document.createElement("canvas");x.width=m,x.height=d,x.style.cssText="width:80px;height:48px";var w=x.getContext("2d");return w.font="bold "+9*u+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=a,w.fillRect(0,0,m,d),w.fillStyle=o,w.fillText(i,f,h),w.fillRect(p,y,g,v),w.fillStyle=a,w.globalAlpha=.9,w.fillRect(p,y,g,v),{dom:x,update:function(O,B){n=Math.min(n,O),l=Math.max(l,O),w.fillStyle=a,w.globalAlpha=1,w.fillRect(0,0,m,y),w.fillStyle=o,w.fillText(c(O)+" "+i+" ("+c(n)+"-"+c(l)+")",f,h),w.drawImage(x,p+u,y,g-u,v,p,y,g-u,v),w.fillRect(p+g-u,y,u,v),w.fillStyle=a,w.globalAlpha=.9,w.fillRect(p+g-u,y,u,c((1-O/B)*v))}}},r})})(Gt);var Ze=Gt.exports;const Je=Kt(Ze),s={distributions:{BOX:1,SPHERE:2,DISC:3,LINE:4},valueOverLifetimeLength:4};typeof define=="function"&&define.amd?define("spe",s):typeof exports<"u"&&typeof module<"u"&&(module.exports=s);s.TypedArrayHelper=function(e,t,r,i){this.componentSize=r||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=i||0};s.TypedArrayHelper.constructor=s.TypedArrayHelper;s.TypedArrayHelper.prototype.setSize=function(e,t){const r=this.array.length;if(t||(e=e*this.componentSize),e<r)return this.shrink(e);if(e>r)return this.grow(e);console.info("TypedArray is already of size:",e+".","Will not resize.")};s.TypedArrayHelper.prototype.shrink=function(e){return this.array=this.array.subarray(0,e),this.size=e,this};s.TypedArrayHelper.prototype.grow=function(e){var t=this.array,r=new this.TypedArrayConstructor(e);return r.set(t),this.array=r,this.size=e,this};s.TypedArrayHelper.prototype.splice=function(e,t){e*=this.componentSize,t*=this.componentSize;for(var r=[],i=this.array,o=i.length,a=0;a<o;++a)(a<e||a>=t)&&r.push(i[a]);return this.setFromArray(0,r),this};s.TypedArrayHelper.prototype.setFromArray=function(e,t){var r=t.length,i=e+r;return i>this.array.length?this.grow(i):i<this.array.length&&this.shrink(i),this.array.set(t,this.indexOffset+e),this};s.TypedArrayHelper.prototype.setVec2=function(e,t){return this.setVec2Components(e,t.x,t.y)};s.TypedArrayHelper.prototype.setVec2Components=function(e,t,r){var i=this.array,o=this.indexOffset+e*this.componentSize;return i[o]=t,i[o+1]=r,this};s.TypedArrayHelper.prototype.setVec3=function(e,t){return this.setVec3Components(e,t.x,t.y,t.z)};s.TypedArrayHelper.prototype.setVec3Components=function(e,t,r,i){var o=this.array,a=this.indexOffset+e*this.componentSize;return o[a]=t,o[a+1]=r,o[a+2]=i,this};s.TypedArrayHelper.prototype.setVec4=function(e,t){return this.setVec4Components(e,t.x,t.y,t.z,t.w)};s.TypedArrayHelper.prototype.setVec4Components=function(e,t,r,i,o){var a=this.array,n=this.indexOffset+e*this.componentSize;return a[n]=t,a[n+1]=r,a[n+2]=i,a[n+3]=o,this};s.TypedArrayHelper.prototype.setMat3=function(e,t){return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)};s.TypedArrayHelper.prototype.setMat4=function(e,t){return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)};s.TypedArrayHelper.prototype.setColor=function(e,t){return this.setVec3Components(e,t.r,t.g,t.b)};s.TypedArrayHelper.prototype.setNumber=function(e,t){return this.array[this.indexOffset+e*this.componentSize]=t,this};s.TypedArrayHelper.prototype.getValueAtIndex=function(e){return this.array[this.indexOffset+e]};s.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){return this.array.subarray(this.indexOffset+e*this.componentSize)};s.ShaderAttribute=function(e,t,r){var i=s.ShaderAttribute.typeSizeMap;this.type=typeof e=="string"&&i.hasOwnProperty(e)?e:"f",this.componentSize=i[this.type],this.arrayType=r||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0};s.ShaderAttribute.constructor=s.ShaderAttribute;s.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16};s.ShaderAttribute.prototype.setUpdateRange=function(e,t){this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)};s.ShaderAttribute.prototype.flagUpdate=function(){var e=this.bufferAttribute,t=e.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.needsUpdate=!0};s.ShaderAttribute.prototype.resetUpdateRange=function(){this.updateMin=0,this.updateMax=0};s.ShaderAttribute.prototype.resetDynamic=function(){this.bufferAttribute.usage=this.dynamicBuffer?Ut:zt};s.ShaderAttribute.prototype.splice=function(e,t){this.typedArray.splice(e,t),this.forceUpdateAll()};s.ShaderAttribute.prototype.forceUpdateAll=function(){this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.usage=zt,this.bufferAttribute.needsUpdate=!0};s.ShaderAttribute.prototype._ensureTypedArray=function(e){this.typedArray!==null&&this.typedArray.size===e*this.componentSize||(this.typedArray!==null&&this.typedArray.size!==e?this.typedArray.setSize(e):this.typedArray===null&&(this.typedArray=new s.TypedArrayHelper(this.arrayType,e,this.componentSize)))};s.ShaderAttribute.prototype._createBufferAttribute=function(e){if(this._ensureTypedArray(e),this.bufferAttribute!==null){this.bufferAttribute.array=this.typedArray.array,parseFloat(Zt)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),this.bufferAttribute.needsUpdate=!0;return}this.bufferAttribute=new it(this.typedArray.array,this.componentSize),this.bufferAttribute.usage=this.dynamicBuffer?Ut:zt};s.ShaderAttribute.prototype.getLength=function(){return this.typedArray===null?0:this.typedArray.array.length};s.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join(`
`),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join(`
`),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;"].join(`
`),varyings:["varying vec4 vColor;","#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif"].join(`
`),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join(`
`),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join(`
`),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join(`
`),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join(`
`),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join(`
`),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join(`
`),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join(`
`),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join(`
`),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );"].join(`
`)};s.shaders={vertex:[s.shaderChunks.defines,s.shaderChunks.uniforms,s.shaderChunks.attributes,s.shaderChunks.varyings,W.common,W.logdepthbuf_pars_vertex,W.fog_pars_vertex,s.shaderChunks.branchAvoidanceFunctions,s.shaderChunks.unpackColor,s.shaderChunks.unpackRotationAxis,s.shaderChunks.floatOverLifetime,s.shaderChunks.colorOverLifetime,s.shaderChunks.paramFetchingFunctions,s.shaderChunks.forceFetchingFunctions,s.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    #ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    #endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",W.logdepthbuf_vertex,W.fog_vertex,"}"].join(`
`),fragment:[s.shaderChunks.uniforms,W.common,W.fog_pars_fragment,W.logdepthbuf_pars_fragment,s.shaderChunks.varyings,s.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",s.shaderChunks.rotateTexture,W.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",W.fog_fragment,"}"].join(`
`)};s.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,r){return typeof e===t?e:r},ensureArrayTypedArg:function(e,t,r){if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(typeof e[i]!==t)return r;return e}return this.ensureTypedArg(e,t,r)},ensureInstanceOf:function(e,t,r){return t!==void 0&&e instanceof t?e:r},ensureArrayInstanceOf:function(e,t,r){if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(t!==void 0&&!(e[i]instanceof t))return r;return e}return this.ensureInstanceOf(e,t,r)},ensureValueOverLifetimeCompliance:function(e,t,r){t=t||3,r=r||3,Array.isArray(e._value)===!1&&(e._value=[e._value]),Array.isArray(e._spread)===!1&&(e._spread=[e._spread]);var i=this.clamp(e._value.length,t,r),o=this.clamp(e._spread.length,t,r),a=Math.max(i,o);e._value.length!==a&&(e._value=this.interpolateArray(e._value,a)),e._spread.length!==a&&(e._spread=this.interpolateArray(e._spread,a))},interpolateArray:function(e,t){for(var r=e.length,i=[typeof e[0].clone=="function"?e[0].clone():e[0]],o=(r-1)/(t-1),a=1;a<t-1;++a){var n=a*o,l=Math.floor(n),c=Math.ceil(n),u=n-l;i[a]=this.lerpTypeAgnostic(e[l],e[c],u)}return i.push(typeof e[r-1].clone=="function"?e[r-1].clone():e[r-1]),i},clamp:function(e,t,r){return Math.max(t,Math.min(e,r))},zeroToEpsilon:function(e,t){var r=1e-5,i=e;return i=t?Math.random()*r*10:r,e<0&&e>-r&&(i=-i),i},lerpTypeAgnostic:function(e,t,r){var i=this.types,o;if(typeof e===i.NUMBER&&typeof t===i.NUMBER)return e+(t-e)*r;if(e instanceof Y&&t instanceof Y)return o=e.clone(),o.x=this.lerp(e.x,t.x,r),o.y=this.lerp(e.y,t.y,r),o;if(e instanceof _&&t instanceof _)return o=e.clone(),o.x=this.lerp(e.x,t.x,r),o.y=this.lerp(e.y,t.y,r),o.z=this.lerp(e.z,t.z,r),o;if(e instanceof Pt&&t instanceof Pt)return o=e.clone(),o.x=this.lerp(e.x,t.x,r),o.y=this.lerp(e.y,t.y,r),o.z=this.lerp(e.z,t.z,r),o.w=this.lerp(e.w,t.w,r),o;if(e instanceof G&&t instanceof G)return o=e.clone(),o.r=this.lerp(e.r,t.r,r),o.g=this.lerp(e.g,t.g,r),o.b=this.lerp(e.b,t.b,r),o;console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,r){return e+(t-e)*r},roundToNearestMultiple:function(e,t){var r=0;return t===0||(r=Math.abs(e)%t,r===0)?e:e<0?-(Math.abs(e)-r):e+t-r},arrayValuesAreEqual:function(e){for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){return e+t*(Math.random()-.5)},randomVector3:function(e,t,r,i,o){var a=r.x+(Math.random()*i.x-i.x*.5),n=r.y+(Math.random()*i.y-i.y*.5),l=r.z+(Math.random()*i.z-i.z*.5);o&&(a=-o.x*.5+this.roundToNearestMultiple(a,o.x),n=-o.y*.5+this.roundToNearestMultiple(n,o.y),l=-o.z*.5+this.roundToNearestMultiple(l,o.z)),e.typedArray.setVec3Components(t,a,n,l)},randomColor:function(e,t,r,i){var o=r.r+Math.random()*i.x,a=r.g+Math.random()*i.y,n=r.b+Math.random()*i.z;o=this.clamp(o,0,1),a=this.clamp(a,0,1),n=this.clamp(n,0,1),e.typedArray.setVec3Components(t,o,a,n)},randomColorAsHex:function(){var e=new G;return function(t,r,i,o){for(var a=i.length,n=[],l=0;l<a;++l){var c=o[l];e.copy(i[l]),e.r+=Math.random()*c.x-c.x*.5,e.g+=Math.random()*c.y-c.y*.5,e.b+=Math.random()*c.z-c.z*.5,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),n.push(e.getHex())}t.typedArray.setVec4Components(r,n[0],n[1],n[2],n[3])}}(),randomVector3OnLine:function(e,t,r,i){var o=r.clone();o.lerp(i,Math.random()),e.typedArray.setVec3Components(t,o.x,o.y,o.z)},randomVector3OnSphere:function(e,t,r,i,o,a,n,l){var c=2*Math.random()-1,u=6.2832*Math.random(),m=Math.sqrt(1-c*c),d=this.randomFloat(i,o),f=0,h=0,p=0;n&&(d=Math.round(d/n)*n),f=m*Math.cos(u)*d,h=m*Math.sin(u)*d,p=c*d,f*=a.x,h*=a.y,p*=a.z,f+=r.x,h+=r.y,p+=r.z,e.typedArray.setVec3Components(t,f,h,p)},seededRandom:function(e){var t=Math.sin(e)*1e4;return t-(t|0)},randomVector3OnDisc:function(e,t,r,i,o,a,n){var l=6.2832*Math.random(),c=Math.abs(this.randomFloat(i,o)),u=0,m=0,d=0;n&&(c=Math.round(c/n)*n),u=Math.cos(l)*c,m=Math.sin(l)*c,u*=a.x,m*=a.y,u+=r.x,m+=r.y,d+=r.z,e.typedArray.setVec3Components(t,u,m,d)},randomDirectionVector3OnSphere:function(){var e=new _;return function(t,r,i,o,a,n,l,c){e.copy(n),e.x-=i,e.y-=o,e.z-=a,e.normalize().multiplyScalar(-this.randomFloat(l,c)),t.typedArray.setVec3Components(r,e.x,e.y,e.z)}}(),randomDirectionVector3OnDisc:function(){var e=new _;return function(t,r,i,o,a,n,l,c){e.copy(n),e.x-=i,e.y-=o,e.z-=a,e.normalize().multiplyScalar(-this.randomFloat(l,c)),t.typedArray.setVec3Components(r,e.x,e.y,0)}}(),getPackedRotationAxis:function(){var e=new _,t=new _,r=new G,i=new _(1,1,1);return function(o,a){return e.copy(o).normalize(),t.copy(a).normalize(),e.x+=-a.x*.5+Math.random()*a.x,e.y+=-a.y*.5+Math.random()*a.y,e.z+=-a.z*.5+Math.random()*a.z,e.normalize().add(i).multiplyScalar(.5),r.setRGB(e.x,e.y,e.z),r.getHex()}}()};s.Group=function(e){var t=s.utils,r=t.types;e=t.ensureTypedArg(e,r.OBJECT,{}),e.texture=t.ensureTypedArg(e.texture,r.OBJECT,{}),this.uuid=Vt.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,r.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,Jt,null),this.textureFrames=t.ensureInstanceOf(e.texture.frames,Y,new Y(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,r.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,r.NUMBER,1),this.textureFrames.max(new Y(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,r.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,r.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,r.NUMBER,null),this.blending=t.ensureTypedArg(e.blending,r.NUMBER,Qt),this.transparent=t.ensureTypedArg(e.transparent,r.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,r.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,r.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,r.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,r.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,r.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new Pt(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:this.fog?new G:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:s.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new s.ShaderAttribute("v3",!0),acceleration:new s.ShaderAttribute("v4",!0),velocity:new s.ShaderAttribute("v3",!0),rotation:new s.ShaderAttribute("v4",!0),rotationCenter:new s.ShaderAttribute("v3",!0),params:new s.ShaderAttribute("v4",!0),size:new s.ShaderAttribute("v4",!0),angle:new s.ShaderAttribute("v4",!0),color:new s.ShaderAttribute("v4",!0),opacity:new s.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new At({uniforms:this.uniforms,vertexShader:s.shaders.vertex,fragmentShader:s.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new bt,this.mesh=new Ht(this.geometry,this.material),this.maxParticleCount===null&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")};s.Group.constructor=s.Group;s.Group.prototype._updateDefines=function(){var e=this.emitters,t=e.length-1,r,i=this.defines;for(t;t>=0;--t)r=e[t],i.SHOULD_CALCULATE_SPRITE||(i.SHOULD_ROTATE_TEXTURE=i.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,r.angle.value),Math.max.apply(null,r.angle.spread))),i.SHOULD_ROTATE_PARTICLES=i.SHOULD_ROTATE_PARTICLES||!!Math.max(r.rotation.angle,r.rotation.angleSpread),i.SHOULD_WIGGLE_PARTICLES=i.SHOULD_WIGGLE_PARTICLES||!!Math.max(r.wiggle.value,r.wiggle.spread);this.material.needsUpdate=!0};s.Group.prototype._applyAttributesToGeometry=function(){var e=this.attributes,t=this.geometry,r=t.attributes,i,o;for(var a in e)e.hasOwnProperty(a)&&(i=e[a],o=r[a],o?o.array=i.typedArray.array:t.setAttribute(a,i.bufferAttribute),i.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)};s.Group.prototype.addEmitter=function(e){if(e instanceof s.Emitter){if(this.emitterIDs.indexOf(e.uuid)>-1){console.error("Emitter already exists in this group. Will not add again.");return}else if(e.group!==null){console.error("Emitter already belongs to another group. Will not add to requested group.");return}}else{console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e);return}var t=this.attributes,r=this.particleCount,i=r+e.particleCount;this.particleCount=i,this.maxParticleCount!==null&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(r),e.group=this,e.attributes=this.attributes;for(var o in t)t.hasOwnProperty(o)&&t[o]._createBufferAttribute(this.maxParticleCount!==null?this.maxParticleCount:this.particleCount);for(var a=r;a<i;++a)e._assignPositionValue(a),e._assignForceValue(a,"velocity"),e._assignForceValue(a,"acceleration"),e._assignAbsLifetimeValue(a,"opacity"),e._assignAbsLifetimeValue(a,"size"),e._assignAngleValue(a),e._assignRotationValue(a),e._assignParamsValue(a),e._assignColorValue(a);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this};s.Group.prototype.removeEmitter=function(e){var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof s.Emitter){if(t===-1){console.error("Emitter does not exist in this group. Will not remove.");return}}else{console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e);return}for(var r=e.attributeOffset,i=r+e.particleCount,o=this.attributes.params.typedArray,a=r;a<i;++a)o.array[a*4]=0,o.array[a*4+1]=0;this.emitters.splice(t,1),this.emitterIDs.splice(t,1);for(var n in this.attributes)this.attributes.hasOwnProperty(n)&&this.attributes[n].splice(r,i);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0};s.Group.prototype.getFromPool=function(){var e=this._pool,t=this._createNewWhenPoolEmpty;if(e.length)return e.pop();if(t){var r=new s.Emitter(this._poolCreationSettings);return this.addEmitter(r),r}return null};s.Group.prototype.releaseIntoPool=function(e){if(!(e instanceof s.Emitter)){console.error("Argument is not instanceof SPE.Emitter:",e);return}return e.reset(),this._pool.unshift(e),this};s.Group.prototype.getPool=function(){return this._pool};s.Group.prototype.addPool=function(e,t,r){var i;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!r;for(var o=0;o<e;++o)Array.isArray(t)?i=new s.Emitter(t[o]):i=new s.Emitter(t),this.addEmitter(i),this.releaseIntoPool(i);return this};s.Group.prototype._triggerSingleEmitter=function(e){var t=this.getFromPool(),r=this;if(t===null){console.log("SPE.Group pool ran out.");return}return e instanceof _&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout(function(){t.disable(),r.releaseIntoPool(t)},Math.max(t.duration,t.maxAge.value+t.maxAge.spread)*1e3),this};s.Group.prototype.triggerPoolEmitter=function(e,t){if(typeof e=="number"&&e>1)for(var r=0;r<e;++r)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this};s.Group.prototype._updateUniforms=function(e){this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e};s.Group.prototype._resetBufferRanges=function(){var e=this.attributeKeys,t=this.attributeCount-1,r=this.attributes;for(t;t>=0;--t)r[e[t]].resetUpdateRange()};s.Group.prototype._updateBuffers=function(e){var t=this.attributeKeys,r=this.attributeCount-1,i=this.attributes,o=e.bufferUpdateRanges,a,n,l;for(r;r>=0;--r)a=t[r],n=o[a],l=i[a],l.setUpdateRange(n.min,n.max),l.flagUpdate()};s.Group.prototype.tick=function(e){var t=this.emitters,r=t.length,i=e||this.fixedTimeStep,o=this.attributeKeys,a,n=this.attributes;if(this._updateUniforms(i),this._resetBufferRanges(),!(r===0&&this._attributesNeedRefresh===!1&&this._attributesNeedDynamicReset===!1)){for(var a=0,l;a<r;++a)l=t[a],l.tick(i),this._updateBuffers(l);if(this._attributesNeedDynamicReset===!0){for(a=this.attributeCount-1,a;a>=0;--a)n[o[a]].resetDynamic();this._attributesNeedDynamicReset=!1}if(this._attributesNeedRefresh===!0){for(a=this.attributeCount-1,a;a>=0;--a)n[o[a]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}};s.Group.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this};s.Emitter=function(e){var t=s.utils,r=t.types,i=s.valueOverLifetimeLength;e=t.ensureTypedArg(e,r.OBJECT,{}),e.position=t.ensureTypedArg(e.position,r.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,r.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,r.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,r.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,r.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,r.OBJECT,{}),e.color=t.ensureTypedArg(e.color,r.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,r.OBJECT,{}),e.size=t.ensureTypedArg(e.size,r.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,r.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,r.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,r.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=Vt.generateUUID(),this.type=t.ensureTypedArg(e.type,r.NUMBER,s.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,_,new _),_spread:t.ensureInstanceOf(e.position.spread,_,new _),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,_,new _),_distribution:t.ensureTypedArg(e.position.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,_,new _(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,r.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,_,new _),_spread:t.ensureInstanceOf(e.velocity.spread,_,new _),_distribution:t.ensureTypedArg(e.velocity.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,_,new _),_spread:t.ensureInstanceOf(e.acceleration.spread,_,new _),_distribution:t.ensureTypedArg(e.acceleration.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.drag={_value:t.ensureTypedArg(e.drag.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,r.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,_,new _(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,_,new _),_angle:t.ensureTypedArg(e.rotation.angle,r.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,r.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,r.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,_,this.position._value.clone()),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,r.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,r.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,G,new G),_spread:t.ensureArrayInstanceOf(e.color.spread,_,new _),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,r.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.particleCount=t.ensureTypedArg(e.particleCount,r.NUMBER,100),this.duration=t.ensureTypedArg(e.duration,r.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,r.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,r.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,r.NUMBER,1),this.alive=t.ensureTypedArg(e.alive,r.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,r.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,r.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,r.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,r.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,r.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,r.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,r.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(var o in this.updateMap)this.updateMap.hasOwnProperty(o)&&(this.updateCounts[this.updateMap[o]]=0,this.updateFlags[this.updateMap[o]]=!1,this._createGetterSetters(this[o],o));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,t.ensureValueOverLifetimeCompliance(this.color,i,i),t.ensureValueOverLifetimeCompliance(this.opacity,i,i),t.ensureValueOverLifetimeCompliance(this.size,i,i),t.ensureValueOverLifetimeCompliance(this.angle,i,i)};s.Emitter.constructor=s.Emitter;s.Emitter.prototype._createGetterSetters=function(e,t){var r=this;for(var i in e)if(e.hasOwnProperty(i)){var o=i.replace("_","");Object.defineProperty(e,o,{get:function(a){return function(){return this[a]}}(i),set:function(a){return function(n){var l=r.updateMap[t],c=this[a],u=s.valueOverLifetimeLength;a==="_rotationCenter"?(r.updateFlags.rotationCenter=!0,r.updateCounts.rotationCenter=0):a==="_randomise"?r.resetFlags[l]=n:(r.updateFlags[l]=!0,r.updateCounts[l]=0),r.group._updateDefines(),this[a]=n,Array.isArray(c)&&s.utils.ensureValueOverLifetimeCompliance(r[t],u,u)}}(i)})}};s.Emitter.prototype._setBufferUpdateRanges=function(e){this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;t>=0;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}};s.Emitter.prototype._calculatePPSValue=function(e){var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e};s.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount};s.Emitter.prototype._assignValue=function(e,t){switch(e){case"position":this._assignPositionValue(t);break;case"velocity":case"acceleration":this._assignForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t);break}};s.Emitter.prototype._assignPositionValue=function(e){var t=s.distributions,r=s.utils,i=this.position,o=this.attributes.position,a=i._value,n=i._spread,l=i._distribution;switch(l){case t.BOX:r.randomVector3(o,e,a,n,i._spreadClamp);break;case t.SPHERE:r.randomVector3OnSphere(o,e,a,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case t.DISC:r.randomVector3OnDisc(o,e,a,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x);break;case t.LINE:r.randomVector3OnLine(o,e,a,n);break}};s.Emitter.prototype._assignForceValue=function(e,t){var r=s.distributions,i=s.utils,o=this[t],a=o._value,n=o._spread,l=o._distribution,c,u,m,d,f;switch(l){case r.BOX:i.randomVector3(this.attributes[t],e,a,n);break;case r.SPHERE:c=this.attributes.position.typedArray.array,f=e*3,u=c[f],m=c[f+1],d=c[f+2],i.randomDirectionVector3OnSphere(this.attributes[t],e,u,m,d,this.position._value,o._value.x,o._spread.x);break;case r.DISC:c=this.attributes.position.typedArray.array,f=e*3,u=c[f],m=c[f+1],d=c[f+2],i.randomDirectionVector3OnDisc(this.attributes[t],e,u,m,d,this.position._value,o._value.x,o._spread.x);break;case r.LINE:i.randomVector3OnLine(this.attributes[t],e,a,n);break}if(t==="acceleration"){var h=i.clamp(i.randomFloat(this.drag._value,this.drag._spread),0,1);this.attributes.acceleration.typedArray.array[e*4+3]=h}};s.Emitter.prototype._assignAbsLifetimeValue=function(e,t){var r=this.attributes[t].typedArray,i=this[t],o=s.utils,a;o.arrayValuesAreEqual(i._value)&&o.arrayValuesAreEqual(i._spread)?(a=Math.abs(o.randomFloat(i._value[0],i._spread[0])),r.setVec4Components(e,a,a,a,a)):r.setVec4Components(e,Math.abs(o.randomFloat(i._value[0],i._spread[0])),Math.abs(o.randomFloat(i._value[1],i._spread[1])),Math.abs(o.randomFloat(i._value[2],i._spread[2])),Math.abs(o.randomFloat(i._value[3],i._spread[3])))};s.Emitter.prototype._assignAngleValue=function(e){var t=this.attributes.angle.typedArray,r=this.angle,i=s.utils,o;i.arrayValuesAreEqual(r._value)&&i.arrayValuesAreEqual(r._spread)?(o=i.randomFloat(r._value[0],r._spread[0]),t.setVec4Components(e,o,o,o,o)):t.setVec4Components(e,i.randomFloat(r._value[0],r._spread[0]),i.randomFloat(r._value[1],r._spread[1]),i.randomFloat(r._value[2],r._spread[2]),i.randomFloat(r._value[3],r._spread[3]))};s.Emitter.prototype._assignParamsValue=function(e){this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(s.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),s.utils.randomFloat(this.wiggle._value,this.wiggle._spread))};s.Emitter.prototype._assignRotationValue=function(e){this.attributes.rotation.typedArray.setVec3Components(e,s.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),s.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)};s.Emitter.prototype._assignColorValue=function(e){s.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)};s.Emitter.prototype._resetParticle=function(e){for(var t=this.resetFlags,r=this.updateFlags,i=this.updateCounts,o=this.attributeKeys,a,n,l=this.attributeCount-1;l>=0;--l)a=o[l],n=r[a],(t[a]===!0||n===!0)&&(this._assignValue(a,e),this._updateAttributeUpdateRange(a,e),n===!0&&i[a]===this.particleCount?(r[a]=!1,i[a]=0):n==!0&&++i[a])};s.Emitter.prototype._updateAttributeUpdateRange=function(e,t){var r=this.bufferUpdateRanges[e];r.min=Math.min(t,r.min),r.max=Math.max(t,r.max)};s.Emitter.prototype._resetBufferRanges=function(){var e=this.bufferUpdateRanges,t=this.bufferUpdateKeys,r=this.bufferUpdateCount-1,i;for(r;r>=0;--r)i=t[r],e[i].min=Number.POSITIVE_INFINITY,e[i].max=Number.NEGATIVE_INFINITY};s.Emitter.prototype._onRemove=function(){this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0};s.Emitter.prototype._decrementParticleCount=function(){--this.activeParticleCount};s.Emitter.prototype._incrementParticleCount=function(){++this.activeParticleCount};s.Emitter.prototype._checkParticleAges=function(e,t,r,i){for(var o=t-1,a,n,l,c;o>=e;--o)a=o*4,c=r[a],c!==0&&(l=r[a+1],n=r[a+2],this.direction===1?(l+=i,l>=n&&(l=0,c=0,this._decrementParticleCount())):(l-=i,l<=0&&(l=n,c=0,this._decrementParticleCount())),r[a]=c,r[a+1]=l,this._updateAttributeUpdateRange("params",o))};s.Emitter.prototype._activateParticles=function(e,t,r,i){for(var o=this.direction,a=e,n,l;a<t;++a)n=a*4,!(r[n]!=0&&this.particleCount!==1)&&(this._incrementParticleCount(),r[n]=1,this._resetParticle(a),l=i*(a-e),r[n+1]=o===-1?r[n+2]-l:l,this._updateAttributeUpdateRange("params",a))};s.Emitter.prototype.tick=function(e){if(!this.isStatic){this.paramsArray===null&&(this.paramsArray=this.attributes.params.typedArray.array);var t=this.attributeOffset,r=t+this.particleCount,i=this.paramsArray,o=this.particlesPerSecond*this.activeMultiplier*e,a=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,r,i,e),this.alive===!1){this.age=0;return}if(this.duration!==null&&this.age>this.duration){this.alive=!1,this.age=0;return}var n=this.particleCount===1?a:a|0,l=Math.min(n+o,this.activationEnd),c=l-this.activationIndex|0,u=c>0?e/c:0;this._activateParticles(n,l,i,u),this.activationIndex+=o,this.activationIndex>r&&(this.activationIndex=t),this.age+=e}};s.Emitter.prototype.reset=function(e){if(this.age=0,this.alive=!1,e===!0){for(var t=this.attributeOffset,r=t+this.particleCount,i=this.paramsArray,o=this.attributes.params.bufferAttribute,a=r-1,n;a>=t;--a)n=a*4,i[n]=0,i[n+1]=0;o.updateRange.offset=0,o.updateRange.count=-1,o.needsUpdate=!0}return this};s.Emitter.prototype.enable=function(){return this.alive=!0,this};s.Emitter.prototype.disable=function(){return this.alive=!1,this};s.Emitter.prototype.remove=function(){return this.group!==null?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this};const Qe=`
  varying vec3 vWorldPosition;
  void main() {
    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
    vWorldPosition = worldPosition.xyz;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
`,tr=`
  uniform vec3 topColor;
  uniform vec3 bottomColor;
  uniform float offset;
  uniform float exponent;
  varying vec3 vWorldPosition;
  void main() {
    float h = normalize( vWorldPosition + offset ).y;
    gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );
  }
`;class er{constructor(t){const r=new te({color:16777215,size:.1,map:new _t().load("/lab-static/images/graph-london/snow.png"),transparent:!0,opacity:.8}),i=new bt,o=5e3,a=new Float32Array(o*3);for(let l=0;l<o*3;l++)a[l]=Math.random()*20-10;i.setAttribute("position",new it(a,3));const n=new Ht(i,r);t.add(n),this.update=function(l){n.geometry.attributes.position.array.forEach((c,u)=>{u%3===1&&(n.geometry.attributes.position.array[u]-=.01,n.geometry.attributes.position.array[u]<-10&&(n.geometry.attributes.position.array[u]=10))}),n.geometry.attributes.position.needsUpdate=!0}}}class rr{constructor(t){const r=new _t,i=new s.Group({texture:{value:r.load("/lab-static/images/graph-london/smock.png")},blending:ee,maxParticleCount:3e3,fog:!0}),o=new s.Emitter({maxAge:{value:28},position:{value:new _(-.35,1.25,0),spread:new _(.1,.05,.1)},size:{value:[.5,1,5],spread:[0,.1,.2]},acceleration:{value:new _(0,.002,0)},rotation:{axis:new _(0,-1,0),spread:new _(0,0,0),angle:720*Math.PI/180},velocity:{value:new _(.03,.06,.03),spread:new _(.025,.04,.025)},opacity:{value:[.2,.4,0]},color:{value:[new G(11184810),new G(16777215)],spread:[new _(0,0,.1),new _(0,0,0)]},particleCount:2500});i.addEmitter(o),t.add(i.mesh),this.emitter=o,this.particleGroup=i,this.stop=function(){o.enabled=!1,o.disable()},this.start=function(){o.enabled=!0,o.enable()},this.update=function(a){i&&i.tick(a)}}}class Ot{constructor(t){this.top=0,this.array=new Float32Array(t)}write(t){this.array[this.top++]=t.x,this.array[this.top++]=t.y,this.array[this.top++]=t.z}}class ir{constructor(t){this.top=0,this.array=new Float32Array(t)}write(t){this.array[this.top++]=t.x,this.array[this.top++]=t.y}}class K{constructor(t){this.plane=null,this.front=null,this.back=null,this.polygons=[],t&&this.build(t)}clone(){const t=new K;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(r=>r.clone()),t}invert(){for(let r=0;r<this.polygons.length;r++)this.polygons[r].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const t=this.front;this.front=this.back,this.back=t}clipPolygons(t){if(!this.plane)return t.slice();let r=new Array,i=new Array;for(let o=0;o<t.length;o++)this.plane.splitPolygon(t[o],r,i,r,i);return this.front&&(r=this.front.clipPolygons(r)),this.back?i=this.back.clipPolygons(i):i=[],r.concat(i)}clipTo(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)}allPolygons(){let t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t}build(t){if(!t.length)return;this.plane||(this.plane=t[0].plane.clone());const r=[],i=[];for(let o=0;o<t.length;o++)this.plane.splitPolygon(t[o],this.polygons,this.polygons,r,i);r.length&&(this.front||(this.front=new K),this.front.build(r)),i.length&&(this.back||(this.back=new K),this.back.build(i))}}class V{constructor(t=0,r=0,i=0){this.x=t,this.y=r,this.z=i}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new V(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}times(t){return this.x*=t,this.y*=t,this.z*=t,this}dividedBy(t){return this.x/=t,this.y/=t,this.z/=t,this}lerp(t,r){return this.add(new V().copy(t).sub(this).times(r))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(t){const r=this.clone(),i=r.x,o=r.y,a=r.z,n=t.x,l=t.y,c=t.z;return this.x=o*c-a*l,this.y=a*n-i*c,this.z=i*l-o*n,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}toVector3(){return new _(this.x,this.y,this.z)}}class ot{constructor(t,r){this.normal=t,this.w=r,this.normal=t,this.w=r}clone(){return new ot(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(t,r,i,o,a){let m=0;const d=[];for(let f=0;f<t.vertices.length;f++){const h=this.normal.dot(t.vertices[f].pos)-this.w,p=h<-ot.EPSILON?2:h>ot.EPSILON?1:0;m|=p,d.push(p)}switch(m){case 0:(this.normal.dot(t.plane.normal)>0?r:i).push(t);break;case 1:o.push(t);break;case 2:a.push(t);break;case 3:{const f=[],h=[];for(let p=0;p<t.vertices.length;p++){const y=(p+1)%t.vertices.length,g=d[p],v=d[y],x=t.vertices[p],w=t.vertices[y];if(g!=2&&f.push(x),g!=1&&h.push(g!=2?x.clone():x),(g|v)==3){const O=(this.w-this.normal.dot(x.pos))/this.normal.dot(new V().copy(w.pos).sub(x.pos)),B=x.interpolate(w,O);f.push(B),h.push(B.clone())}}f.length>=3&&o.push(new st(f,t.shared)),h.length>=3&&a.push(new st(h,t.shared));break}}}static fromPoints(t,r,i){const o=new V().copy(r).sub(t).cross(new V().copy(i).sub(t)).normalize();return new ot(o.clone(),o.dot(t))}}ot.EPSILON=1e-5;class st{constructor(t,r){this.vertices=t,this.shared=r,this.plane=ot.fromPoints(t[0].pos,t[1].pos,t[2].pos)}clone(){return new st(this.vertices.map(t=>t.clone()),this.shared)}flip(){this.vertices.reverse().map(t=>t.flip()),this.plane.flip()}}class yt{constructor(t,r,i,o){this.pos=new V().copy(t),this.normal=new V().copy(r),this.uv=new V().copy(i),this.uv.z=0,o&&(this.color=new V().copy(o))}clone(){return new yt(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(t,r){return new yt(this.pos.clone().lerp(t.pos,r),this.normal.clone().lerp(t.normal,r),this.uv.clone().lerp(t.uv,r),this.color&&t.color&&this.color.clone().lerp(t.color,r))}}class I{constructor(){this.polygons=[]}static fromPolygons(t){const r=new I;return r.polygons=t,r}static fromGeometry(t,r){let i=[];const o=t.attributes.position,a=t.attributes.normal,n=t.attributes.uv,l=t.attributes.color,c=t.groups;let u;if(t.index)u=t.index.array;else{u=new Uint16Array(o.array.length/o.itemSize|0);for(let d=0;d<u.length;d++)u[d]=d}const m=u.length/3|0;i=new Array(m);for(let d=0,f=0,h=u.length;d<h;d+=3,f++){const p=new Array(3);for(let y=0;y<3;y++){const g=u[d+y],v=g*3,x=g*2,w=o.array[v],O=o.array[v+1],B=o.array[v+2],k=a.array[v],M=a.array[v+1],F=a.array[v+2],E=n==null?void 0:n.array[x],P=n==null?void 0:n.array[x+1];p[y]=new yt(new V(w,O,B),new V(k,M,F),new V(E,P,0),l&&new V(l.array[v],l.array[v+1],l.array[v+2]))}if(r===void 0&&c&&c.length>0)for(const y of c)d>=y.start&&d<y.start+y.count&&(i[f]=new st(p,y.materialIndex));else i[f]=new st(p,r)}return I.fromPolygons(i.filter(d=>!Number.isNaN(d.plane.normal.x)))}static toGeometry(t,r){let i=0;const o=t.polygons;for(const h of o)i+=h.vertices.length-2;const a=new bt,n=new Ot(i*3*3),l=new Ot(i*3*3),c=new ir(i*2*3);let u;const m=[],d=[];for(const h of o){const p=h.vertices,y=p.length;h.shared!==void 0&&(m[h.shared]||(m[h.shared]=[])),y&&p[0].color!==void 0&&(u||(u=new Ot(i*3*3)));for(let g=3;g<=y;g++)(h.shared===void 0?d:m[h.shared]).push(n.top/3,n.top/3+1,n.top/3+2),n.write(p[0].pos),n.write(p[g-2].pos),n.write(p[g-1].pos),l.write(p[0].normal),l.write(p[g-2].normal),l.write(p[g-1].normal),c&&(c.write(p[0].uv),c.write(p[g-2].uv),c.write(p[g-1].uv)),u&&(u.write(p[0].color),u.write(p[g-2].color),u.write(p[g-1].color))}a.setAttribute("position",new it(n.array,3)),a.setAttribute("normal",new it(l.array,3)),c&&a.setAttribute("uv",new it(c.array,2)),u&&a.setAttribute("color",new it(u.array,3));for(let h=0;h<m.length;h++)m[h]===void 0&&(m[h]=[]);if(m.length){let h=[],p=0;for(let y=0;y<m.length;y++)a.addGroup(p,m[y].length,y),p+=m[y].length,h=h.concat(m[y]);a.addGroup(p,d.length,m.length),h=h.concat(d),a.setIndex(h)}const f=new j().copy(r).invert();return a.applyMatrix4(f),a.computeBoundingSphere(),a.computeBoundingBox(),a}static fromMesh(t,r){const i=I.fromGeometry(t.geometry,r),o=new _,a=new re;a.getNormalMatrix(t.matrix);for(let n=0;n<i.polygons.length;n++){const l=i.polygons[n];for(let c=0;c<l.vertices.length;c++){const u=l.vertices[c];u.pos.copy(o.copy(u.pos.toVector3()).applyMatrix4(t.matrix)),u.normal.copy(o.copy(u.normal.toVector3()).applyMatrix3(a))}}return i}static toMesh(t,r,i){const o=I.toGeometry(t,r),a=new L(o,i);return a.matrix.copy(r),a.matrix.decompose(a.position,a.quaternion,a.scale),a.rotation.setFromQuaternion(a.quaternion),a.updateMatrixWorld(),a.castShadow=a.receiveShadow=!0,a}static union(t,r){const i=I.fromMesh(t),o=I.fromMesh(r);return I.toMesh(i.union(o),t.matrix,t.material)}static subtract(t,r){const i=I.fromMesh(t),o=I.fromMesh(r);return I.toMesh(i.subtract(o),t.matrix,t.material)}static intersect(t,r){const i=I.fromMesh(t),o=I.fromMesh(r);return I.toMesh(i.intersect(o),t.matrix,t.material)}clone(){const t=new I;return t.polygons=this.polygons.map(r=>r.clone()).filter(r=>Number.isFinite(r.plane.w)),t}toPolygons(){return this.polygons}union(t){const r=new K(this.clone().polygons),i=new K(t.clone().polygons);return r.clipTo(i),i.clipTo(r),i.invert(),i.clipTo(r),i.invert(),r.build(i.allPolygons()),I.fromPolygons(r.allPolygons())}subtract(t){const r=new K(this.clone().polygons),i=new K(t.clone().polygons);return r.invert(),r.clipTo(i),i.clipTo(r),i.invert(),i.clipTo(r),i.invert(),r.build(i.allPolygons()),r.invert(),I.fromPolygons(r.allPolygons())}intersect(t){const r=new K(this.clone().polygons),i=new K(t.clone().polygons);return r.invert(),i.clipTo(r),i.invert(),r.clipTo(i),i.clipTo(r),r.build(i.allPolygons()),r.invert(),I.fromPolygons(r.allPolygons())}inverse(){const t=this.clone();for(const r of t.polygons)r.flip();return t}toMesh(t,r){return I.toMesh(this,t,r)}toGeometry(t){return I.toGeometry(this,t)}}const or=e=>(lt("data-v-ab06fb11"),e=e(),ct(),e),ar={class:"chapter-item"},nr=or(()=>N("h2",null,"Final Session",-1)),sr=Z({__name:"final-chapter",setup(e){const t=X(null),r=X(null);at(()=>{P(),$(),E(),M(),F(),B(),k(),f(),h(),O(),w(),A()});let i,o,a,n,l=0,c,u,m;const d=new ue;function f(){const T=new ie,C=v();T.add(C);const b=g();T.add(b);const S=x();T.add(S);const R=p();T.add(R);const z=y(S,R);T.add(z),T.position.set(0,-.02,0),o.add(T)}function h(){const T=new et({color:16716049,wireframe:!1}),C=new Bt,b=T.clone();b.color.setHex(5964290);const S=new ht(.04,.04,.22,32,1,!1,0,Math.PI);S.applyMatrix4(new j().makeRotationZ(90*Math.PI/180)),S.applyMatrix4(new j().makeTranslation(0,.2,0));const R=new L(S,b),z=new q(.22,.04,.08);z.applyMatrix4(new j().makeTranslation(0,.18,0));const U=new L(z,b),H=T.clone();H.color.setHex(8874516);const ut=new ht(.02,.02,.16);ut.applyMatrix4(new j().makeTranslation(0,.08,0));const Ct=new L(ut,H);C.add(R),C.add(U),C.add(Ct),C.position.set(.3,0,-1),C.castShadow=!0,o.add(C)}function p(){const T=new q(.3,.5,.1);T.applyMatrix4(new j().makeTranslation(-.3,-.1,-.45));const C=new et({color:16716049,wireframe:!1}),b=C.clone();b.color.setHex(8874516);const S=new L(T,b),R=new ht(.02,.02,.01,16);R.applyMatrix4(new j().makeRotationX(Math.PI/2)),R.applyMatrix4(new j().makeTranslation(-.2,-.1,-.5));const z=C.clone();z.color.setHex(16777215);const U=new L(R,z),H=new Bt;return H.add(S),H.add(U),H.position.set(0,.4,0),H.castShadow=!0,H}function y(T,C){const b=new et({color:16716049,wireframe:!1}),S=new q(1,.8,1),R=new L(S,b);R.updateMatrix();const z=R.clone();z.scale.multiplyScalar(.9),z.updateMatrix();let U=I.subtract(R,z);U=I.subtract(U,T);for(const H of C.children)U=I.subtract(U,H);return U.position.set(0,.4,0),U}function g(){const T=new rt({color:16716049,wireframe:!1}),C=new q(.2,.4,.2),b=new L(C,T);b.material.color.setHex(14344422),b.position.set(-.35,1.05,0);const S=new ht(.08,.08,.1,8),R=new et({color:16716049,wireframe:!1}),z=new L(S,R);return z.material.color.setHex(2236962),z.position.set(0,.151,0),z.matrixAutoUpdate=!1,z.updateMatrix(),b.add(z),b}function v(){const T=new rt({color:16716049,wireframe:!1}),C=.25,b=new ht(0,C*3,C*3,4),S=new L(b,T.clone());return S.material.color.setHex(16777215),S.rotation.y=45*Math.PI/180,S.position.set(0,.8+.35,0),S.matrixAutoUpdate=!1,S.updateMatrix(),S}function x(){const T=new et({color:16716049,wireframe:!1}),C=new q(.2,.2,.06);C.applyMatrix4(new j().makeTranslation(.25,-0,-.48));const b=new L(C,T.clone());return b.material.color.setHex(16777215),b.material.transparent=!0,b.material.opacity=.4,b.position.set(0,.4,0),b}function w(){u=new er(o)}function O(){m=new rr(o)}function B(){const T=new q(10,.01,1),C=new q(.7,.01,.1),b=new rt({color:10596019}),S=new rt({color:14344422}),R=new L(T,b),z=6;for(let U=0;U<z;U++){const H=z/2,ut=C.clone(),Ct=new j().makeTranslation(U*1.7-H-1,.01,0);ut.applyMatrix4(Ct),R.add(new L(ut,S))}R.position.set(0,0,-2.5),o.add(R)}function k(){const C=new _t().load("/lab-static/images/graph-london/inside-box-texture.jpg");c=new L(new q(.2,.1,.01),new et({map:C})),c.position.set(0,.3,-.1);let b=0;c.userData.update=function(S){b+=S,c.position.y=.3+Math.sin(b*2)/20,c.rotation.z=0+Math.cos(b)/2},o.add(c)}function M(){const T=new rt({color:15658734}),C=new wt(10,10,1,1),b=new L(C,T);b.rotation.x=-Math.PI/2,o.add(b),b.receiveShadow=!1;const S=new oe({opacity:.1}),R=new L(C,S);R.rotation.x=-Math.PI/2,R.receiveShadow=!0,R.position.y=.001,o.add(R)}function F(){const T=new ae(16777215,16777215,.6);T.color.setHSL(.6,1,.6),T.groundColor.setHSL(.095,.8,.5),T.position.set(0,5,0),o.add(T);const C=new Ft(16777215,1);C.color.setHSL(.6,.1,1),C.position.set(-1,1.75,-1),C.position.multiplyScalar(5),o.add(C),C.castShadow=!0;const b=new ne(16777045,3);b.distance=1.5,b.position.set(0,.4,0),o.add(b)}function E(){const T={topColor:{value:new G(11189247)},bottomColor:{value:new G(16777215)},offset:{value:50},exponent:{value:.6}},C=new At({uniforms:T,vertexShader:Qe,fragmentShader:tr,side:se}),b=new Lt(400,32,15),S=new L(b,C);o.add(S),o.fog=new le(C.uniforms.bottomColor.value,1,15)}function P(){i=new Je,t.value.appendChild(i.dom)}function A(){D(),requestAnimationFrame(A)}function D(){i.update(),l=d.getDelta(),c.userData.update(l),u.update(),m.update(),a.render(o,n)}function $(){o=new vt,a=new xt({antialias:!0}),a.setPixelRatio(window.devicePixelRatio),a.setSize(400,400),a.shadowMap.enabled=!0,a.shadowMap.type=ce,r.value.appendChild(a.domElement),n=new gt(60,400/400,.1,500),n.position.set(-2,1,-4);const T=new Dt(n,a.domElement);T.mouseButtons={LEFT:Et.RIGHT,MIDDLE:Et.MIDDLE,RIGHT:Et.LEFT},T.update()}return(T,C)=>(J(),Q("div",ar,[nr,N("div",{class:"canvas",ref_key:"finalRef",ref:r},[N("div",{ref_key:"statsRef",ref:t,class:"stats-box"},null,512)],512)]))}}),lr=nt(sr,[["__scopeId","data-v-ab06fb11"]]),cr={class:"graph-london"},ur=Z({__name:"index",setup(e){return(t,r)=>(J(),Q("div",cr,[tt(ge),tt(Ce),tt(Le),tt(Fe),tt(We),tt(Ye),tt(lr)]))}}),dr=nt(ur,[["__scopeId","data-v-98bb7e4b"]]);export{dr as default};
